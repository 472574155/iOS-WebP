<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>iOS-WebP by seanooi</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>iOS-WebP</h1>
        <h2>Google&#39;s WebP image format decoder and encoder for iOS</h2>
        <a href="https://github.com/seanooi/iOS-WebP" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a name="ios-webp" class="anchor" href="#ios-webp"><span class="octicon octicon-link"></span></a>iOS-WebP</h1>

<p>Most apps nowadays enhance user experience with the use of images, and one of the issues I've noticed with that is the amount of time it takes to load an image. (<em>Not everyone has the luxury of a fast connection</em>)</p>

<p>Google's WebP image format offers better compression compared to PNG or JPEG, allowing apps to send/retrieve images with smaller file sizes, reducing request times and hopefully provide a better user experience.</p>

<p><img src="http://i.imgur.com/tUCyYhD.png" alt="alt demo" title="Demo Screenshot"></p>

<h1>
<a name="getting-started" class="anchor" href="#getting-started"><span class="octicon octicon-link"></span></a>Getting Started</h1>

<h3>
<a name="the-cocoapods-way" class="anchor" href="#the-cocoapods-way"><span class="octicon octicon-link"></span></a>The CocoaPods Way</h3>

<div class="highlight highlight-ruby"><pre><span class="n">pod</span> <span class="s1">'iOS-WebP'</span><span class="p">,</span> <span class="s1">'0.3'</span>
</pre></div>

<h3>
<a name="the-manual-way" class="anchor" href="#the-manual-way"><span class="octicon octicon-link"></span></a>The Manual Way</h3>

<p>Include the 3 files inside the <code>iOS-WebP</code> folder into your project:</p>

<ul>
<li><code>UIImage+WebP.h</code></li>
<li><code>UIImage+WebP.m</code></li>
<li><code>WebP.framework</code></li>
</ul><h1>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h1>

<p>Don't forget to <code>#import "UIImage+WebP.h"</code> or <code>#import &lt;UIImage+WebP.h&gt;</code> if you're using cocoapods.
There are 3 methods in <code>iOS-WebP</code>, converting images <strong>to</strong> WebP format, converting images <strong>from</strong> WebP format, and setting an image's transparency.</p>

<div class="highlight highlight-objc"><pre><span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">imageToWebP:</span><span class="p">(</span><span class="n">UIImage</span> <span class="o">*</span><span class="p">)</span><span class="nv">image</span> <span class="nf">quality:</span><span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nv">quality</span> <span class="nf">alpha:</span><span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nv">alpha</span> <span class="nf">preset:</span><span class="p">(</span><span class="n">WebPPreset</span><span class="p">)</span><span class="nv">preset</span>
    <span class="nl">completionBlock:</span><span class="p">(</span><span class="kt">void</span> <span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">NSData</span> <span class="o">*</span><span class="n">result</span><span class="p">))</span><span class="nv">completionBlock</span>
       <span class="nl">failureBlock:</span><span class="p">(</span><span class="kt">void</span> <span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">))</span><span class="nv">failureBlock</span><span class="p">;</span>

<span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">imageFromWebP:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">filePath</span>
      <span class="nl">completionBlock:</span><span class="p">(</span><span class="kt">void</span> <span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">UIImage</span> <span class="o">*</span><span class="n">result</span><span class="p">))</span><span class="nv">completionBlock</span>
         <span class="nl">failureBlock:</span><span class="p">(</span><span class="kt">void</span> <span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">))</span><span class="nv">failureBlock</span><span class="p">;</span>

<span class="k">-</span> <span class="p">(</span><span class="n">UIImage</span> <span class="o">*</span><span class="p">)</span><span class="nf">imageByApplyingAlpha:</span><span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nv">alpha</span><span class="p">;</span>
</pre></div>

<p>Encoding and decoding of images are done in the background thread and results returned in the completion block on the main thread so as not to lock the main thread, allowing the UI to be updated as needed.</p>

<h4>
<a name="converting-to-webp" class="anchor" href="#converting-to-webp"><span class="octicon octicon-link"></span></a>Converting To WebP</h4>

<div class="highlight highlight-objc"><pre><span class="c1">// quality value is [0, 100]</span>
<span class="c1">// alpha value is [0, 1]</span>
<span class="p">[</span><span class="n">UIImage</span> <span class="n">imageToWebP</span><span class="o">:</span><span class="p">[</span><span class="n">UIImage</span> <span class="n">imageNamed</span><span class="o">:</span><span class="s">@"demo.jpg"</span><span class="p">]</span> <span class="n">quality</span><span class="o">:</span><span class="n">quality</span> <span class="n">alpha</span><span class="o">:</span><span class="n">alpha</span> <span class="n">preset</span><span class="o">:</span><span class="n">WEBP_PRESET_DEFAULT</span> <span class="n">completionBlock</span><span class="o">:^</span><span class="p">(</span><span class="n">NSData</span> <span class="o">*</span><span class="n">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">NSArray</span> <span class="o">*</span><span class="n">paths</span> <span class="o">=</span> <span class="n">NSSearchPathForDirectoriesInDomains</span><span class="p">(</span><span class="n">NSDocumentDirectory</span><span class="p">,</span> <span class="n">NSUserDomainMask</span><span class="p">,</span> <span class="nb">YES</span><span class="p">);</span>
  <span class="n">NSString</span> <span class="o">*</span><span class="n">webPPath</span> <span class="o">=</span> <span class="p">[</span><span class="n">paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="n">stringByAppendingPathComponent</span><span class="o">:</span><span class="s">@"image.webp"</span><span class="p">];</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">[</span><span class="n">webPData</span> <span class="n">writeToFile</span><span class="o">:</span><span class="n">webPPath</span> <span class="n">atomically</span><span class="o">:</span><span class="nb">YES</span><span class="p">])</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Failed to save file"</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span> <span class="n">failureBlock</span><span class="o">:^</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">NSLog</span><span class="p">(</span><span class="s">@"%@"</span><span class="p">,</span> <span class="n">error</span><span class="p">.</span><span class="n">localizedDescription</span><span class="p">);</span>
<span class="p">}];</span>
</pre></div>

<h5>
<a name="webppreset-possible-values" class="anchor" href="#webppreset-possible-values"><span class="octicon octicon-link"></span></a><code>WebPPreset</code> possible values</h5>

<ul>
<li>
<code>WEBP_PRESET_DEFAULT</code> <em>(default preset)</em>
</li>
<li>
<code>WEBP_PRESET_PICTURE</code> <em>(digital picture, like portrait, inner shot)</em>
</li>
<li>
<code>WEBP_PRESET_PHOTO</code>   <em>(outdoor photograph, with natural lighting)</em>
</li>
<li>
<code>WEBP_PRESET_DRAWING</code> <em>(hand or line drawing, with high-contrast details)</em>
</li>
<li>
<code>WEBP_PRESET_ICON</code>    <em>(small-sized colorful images)</em>
</li>
<li>
<code>WEBP_PRESET_TEXT</code>    <em>(text-like)</em>
</li>
</ul><h4>
<a name="converting-from-webp" class="anchor" href="#converting-from-webp"><span class="octicon octicon-link"></span></a>Converting From WebP</h4>

<div class="highlight highlight-objc"><pre><span class="p">[</span><span class="n">UIImage</span> <span class="n">imageFromWebP</span><span class="o">:</span><span class="s">@"/path/to/file"</span> <span class="n">completionBlock</span><span class="o">:^</span><span class="p">(</span><span class="n">UIImage</span> <span class="o">*</span><span class="n">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">UIImageView</span> <span class="o">*</span><span class="n">myImageView</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIImageView</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">initWithImage</span><span class="o">:</span><span class="n">result</span><span class="p">];</span>
<span class="p">}</span><span class="n">failureBlock</span><span class="o">:^</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">NSLog</span><span class="p">(</span><span class="s">@"%@"</span><span class="p">,</span> <span class="n">error</span><span class="p">.</span><span class="n">localizedDescription</span><span class="p">);</span>
<span class="p">}];</span>
</pre></div>

<h4>
<a name="setting-image-transparency" class="anchor" href="#setting-image-transparency"><span class="octicon octicon-link"></span></a>Setting Image Transparency</h4>

<div class="highlight highlight-objc"><pre><span class="c1">//alpha value is [0, 1]</span>
<span class="n">UIImage</span> <span class="o">*</span><span class="n">transparencyImage</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIImage</span> <span class="n">imageNamed</span><span class="o">:</span><span class="n">image</span><span class="p">.</span><span class="n">jpg</span><span class="p">]</span> <span class="n">imageByApplyingAlpha</span><span class="o">:</span><span class="mf">0.5</span><span class="p">];</span>
</pre></div>

<h1>
<a name="credit" class="anchor" href="#credit"><span class="octicon octicon-link"></span></a>Credit</h1>

<ul>
<li>Based off <a href="https://github.com/carsonmcdonald/WebP-iOS-example" title="WebP-iOS-example">WebP-iOS-example</a> by Carson McDonald</li>
<li>
<code>imageByApplyingAlpha:alpha</code> function contributed by <a href="https://github.com/shmidt">shmidt</a>
</li>
</ul>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/seanooi/iOS-WebP/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/seanooi/iOS-WebP/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/seanooi/iOS-WebP"></a> is maintained by <a href="https://github.com/seanooi">seanooi</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>